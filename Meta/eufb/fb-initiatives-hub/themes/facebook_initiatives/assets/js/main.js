"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();!function(){window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(t,e){e=e||window;for(var n=0;n<this.length;n++)t.call(e,this[n],n,this)});var t=function(){function t(){_classCallCheck(this,t),this.initLinkTracking()}return _createClass(t,[{key:"initLinkTracking",value:function(){var t=this;document.querySelectorAll("a[href]").forEach(function(e){return e.addEventListener("click",t.onLinkClicked.bind(t))})}},{key:"onLinkClicked",value:function(e){t.trackEvent("Link","click",e.currentTarget.href)}}],[{key:"trackEvent",value:function(t,e,n){if(console.log("Track event:",t,e,n),!window.dataLayer)return console.warn("Google Tag Manager data layer not found. Tracking may not be operational."),void(window.dataLayer=[]);window.dataLayer.push({event:t,eventAction:e,eventLabel:n})}}]),t}(),e=function(){function e(){_classCallCheck(this,e),this.initBurgerButton(),this.initSmoothScroll(),this.passiveScrollHandler=this.onPassiveScroll.bind(this),window.addEventListener("scroll",this.onScroll.bind(this)),window.addEventListener("mousewheel",this.onMouseWheel.bind(this)),window.addEventListener("touchstart",this.onTouchStart.bind(this)),this.onScroll()}return _createClass(e,[{key:"initBurgerButton",value:function(){document.querySelector("[data-menu-button]").onclick=function(){return document.body.classList.toggle("menu--show")}}},{key:"initSmoothScroll",value:function(){var t=this,e=document.querySelectorAll("[data-smooth-scroll]");this.smoothScrollLinkClickedHandler=this.onSmoothScrollLinkClicked.bind(this),e.forEach(function(e){e.addEventListener("click",t.smoothScrollLinkClickedHandler)})}},{key:"getCurrentSection",value:function(){var t=document.querySelectorAll("[data-scroll-anchor]"),e=(window.scrollY||window.pageYOffset)+window.innerHeight;if(document.body.scrollHeight-e<10)return t[t.length-1].name;for(var n=t.length-1;n>=0;n--){var i=t[n];if(i.getBoundingClientRect().top<=0)return i.name}}},{key:"updateAnchorClass",value:function(t){var e=document.body.classList;e.remove(this.anchorClass),this.anchorClass="section--"+t,e.add(this.anchorClass)}},{key:"updateURL",value:function(t){history.replaceState("","","#"+t)}},{key:"smoothScroll",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=void 0,i=performance.now(),o=window.pageYOffset,r=document.body.getBoundingClientRect().bottom-window.innerHeight,a=Math.min(t.getBoundingClientRect().top,r),s=function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e};this.scrollAnimation=function(){n=Math.min(performance.now()-i,e);var t=s(n,o,a,e);window.scroll(0,t),n>=e?(this.isSmoothScrolling=!1,this.onScroll()):this.isSmoothScrolling&&requestAnimationFrame(this.scrollAnimation)}.bind(this),this.isSmoothScrolling=!1,cancelAnimationFrame(this.scrollAnimation),this.isSmoothScrolling=!0,requestAnimationFrame(this.scrollAnimation)}},{key:"onScroll",value:function(){this.isSmoothScrolling||this.debounce||setTimeout(this.passiveScrollHandler,100)}},{key:"onPassiveScroll",value:function(){var e=this.getCurrentSection();e!==this.oldSection&&(this.updateURL(e),this.updateAnchorClass(e),t.trackEvent("Section","scroll",e)),this.oldSection=e,this.debounce=null}},{key:"onSmoothScrollLinkClicked",value:function(t){t.preventDefault(),document.body.classList.remove("menu--show");var e=t.currentTarget.href.split("#")[1],n=document.querySelectorAll("a[name="+e+"]")[0];this.updateURL(e),this.updateAnchorClass(e),this.smoothScroll(n)}},{key:"onMouseWheel",value:function(){this.isSmoothScrolling=!1}},{key:"onTouchStart",value:function(){this.isSmoothScrolling=!1}}]),e}(),n=function(){function e(){_classCallCheck(this,e),this.filters=this.initFilters(),this.programs=this.initPrograms(),this.heroes=document.querySelectorAll("[data-programs-hero]"),this.grid=document.querySelector("[data-programs-grid]"),window.addEventListener("resize",this.onResize.bind(this)),this.onResize(),this.updateFilter("")}return _createClass(e,[{key:"initPrograms",value:function(){var t=this,e=document.querySelectorAll("[data-program]");return e.forEach(function(e){e.addEventListener("click",t.onProgramClicked.bind(t,e))}),e}},{key:"initFilters",value:function(){var t=this,e=document.querySelectorAll("[data-filter]");return e.forEach(function(e){e.addEventListener("click",t.onFilterClicked.bind(t,e.attributes["data-filter"].value))}),e}},{key:"updatePrograms",value:function(){var t=this.grid.getBoundingClientRect();this.programs.forEach(function(e){var n=e.getBoundingClientRect();n.right===t.right&&n.left!==t.left?e.classList.add("program--right"):e.classList.remove("program--right"),n.bottom===t.bottom&&t.height>2*n.height?e.classList.add("program--bottom"):e.classList.remove("program--bottom")})}},{key:"updateFilter",value:function(t){this.filters.forEach(function(e){e.attributes["data-filter"].value===t?e.classList.add("selected"):e.classList.remove("selected")}),this.programs.forEach(function(e){var n=e.attributes["data-tags"].value.split(" ");!t||n.indexOf(t)>=0?e.classList.remove("program--hidden"):e.classList.add("program--hidden")}),this.heroes.forEach(function(e){var n=e.attributes["data-tags"].value.split(" ");t?n.indexOf(t)>=0?e.classList.remove("programs__hero--hidden"):e.classList.add("programs__hero--hidden"):1!==n.length||n[0]?e.classList.add("programs__hero--hidden"):e.classList.remove("programs__hero--hidden")}),this.onResize()}},{key:"onProgramClicked",value:function(e){this.programs.forEach(function(n){if(n===e){if(!n.classList.contains("program--expanded")){var i=n.querySelector(".program__heading").textContent;t.trackEvent("Program","open",i)}n.classList.toggle("program--expanded")}else n.classList.remove("program--expanded")})}},{key:"onFilterClicked",value:function(t){this.updateFilter(t)}},{key:"onResize",value:function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.onPassiveResize.bind(this),100)}},{key:"onPassiveResize",value:function(){this.updatePrograms()}}]),e}(),i=function(){function t(){_classCallCheck(this,t),this.initCountrySelector()}return _createClass(t,[{key:"initCountrySelector",value:function(){var t=document.querySelector("[data-country-selector]");t&&t.addEventListener("change",this.onCountrySelectorChanged.bind(this))}},{key:"onCountrySelectorChanged",value:function(t){window.location=t.target.value}}]),t}();new function o(){_classCallCheck(this,o),new e,new t,new n,new i}}();
//# sourceMappingURL=main.js.map
